<!DOCTYPE html>
<html lang="en">

<head>
    <title>Orbit Player</title>
    <link rel="icon" href="img/orbit_ico_blue.png">
    <link rel="stylesheet" href="css/styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

    <header>
        <p><a href="start.html"><img src="img/orbit_white.png" width="140" height="50" title="Orbit Player"></a></p>

        <p>
            <a href="explore.html"> Explore </a> •
            <a href="news.html"> Updates </a>
        </p>

        <!-- Botão fixo -->
        <button id="fixedButton" onclick="toggleDarkMode()">Switch Theme</button>


    </header>

    <main>
        <article>

            <p align="center">
                <input type="text" id="search" onkeyup="search()" placeholder="Search music..." width="300" height="40">

                <button onclick="skipSong()">Skip</button>
            </p>

            <ul align="center" id="results"></ul>

            <article>

            </article>

            <aside>
            </aside>
    </main>

    <footer>

        <p align="center" id="tituloMusica"></p>

        <p align="center">
            <audio id="audioPlayer" controls onended="playRandom()">
                <source id="audioSource" src="" type="audio/mp3">
                Seu navegador não suporta a tag de áudio.
            </audio>
        </p>

    </footer>

    <script>
        // lightmode script
        function toggleDarkMode() {
            const body = document.body;
            body.classList.toggle('light-mode');
        }

        // anti right-click protection
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        });

        var data = [
            { title: "Cigarettes After Sex - Apocalypse", url: "music/indie/Cigarettes After Sex - Apocalypse.mp3" },
            { title: "Ali Gatie - Its you", url: "music/temp/Ali Gatie - Its you.mp3" },
            { title: "Modestia - Slow", url: "music/rap/Modestia - Slow.mp3" },
            { title: "Xama - Era uma vez", url: "music/rap/Xama - Era uma vez.mp3" },
        ];

        var ul = document.getElementById("results");

        function displayResults(titles) {
            ul.innerHTML = ""; // Limpa a lista antes de adicionar novos itens

            titles.forEach(function (title) {
                var li = document.createElement("li");
                var a = document.createElement("a");
                a.href = "#"; // Defina o href para # para evitar que o link abra uma nova página
                a.onclick = function (index) {
                    return function () {
                        changeAudioSource(index);
                    };
                }(data.findIndex(function (item) {
                    return item.title === title;
                })); // Encontra o índice da música correspondente ao título
                a.textContent = title;
                li.appendChild(a);
                ul.appendChild(li);
                li.style.display = "block"; // Mostra todos os itens
            });
        }

        function changeAudioSource(index) {
            var audio = document.getElementById('audioPlayer');
            var source = document.getElementById('audioSource');

            source.src = data[index].url;
            audio.load();
            audio.play();
            displayCurrentSongTitle(data[index].title); // Chama a função para exibir o título da música
        }

        function search() {
            var input = document.getElementById("search");
            var filter = input.value.toUpperCase();
            var filteredTitles = [];

            if (filter !== "") {
                filteredTitles = data.filter(function (item) {
                    return item.title.toUpperCase().indexOf(filter) > -1;
                }).map(function (item) {
                    return item.title;
                });
            }

            displayResults(filteredTitles);

            if (filter.length == 0) {
                ul.style.display = "none"; // Oculta a lista quando o campo de pesquisa estiver vazio
            } else {
                ul.style.display = "block"; // Mostra a lista quando houver texto no campo de pesquisa
            }
        }

        function displayCurrentSongTitle(title) {
            var tituloMusica = document.getElementById("tituloMusica");
            tituloMusica.textContent = title;
        }

        // Script de reprodução aleatória
        var audioPlayer = document.getElementById('audioPlayer');
        var audioSource = document.getElementById('audioSource');

        function getRandomTrack() {
            var randomIndex = Math.floor(Math.random() * data.length);
            return data[randomIndex];
        }

        function playRandom() {
            var randomTrack = getRandomTrack();
            audioSource.src = randomTrack.url; // Correção: use randomTrack.url para obter o URL da música
            audioPlayer.load();
            audioPlayer.play();
            displayCurrentSongTitle(randomTrack.title); // Chama a função para exibir o título da música
        }

        function skipSong() {
            playRandom();
        }

        // Inicie a reprodução com a primeira música aleatória
        playRandom();
    </script>

</body>

</html>
